module Day5 where

import Data.Char
import qualified Data.Map.Strict as Map
import Data.Maybe

day5_1 :: String -> Int
day5_1 s = jumpList (processInput s) 0 0

processInput :: String -> [Int]
processInput s = map read (lines s)

jumpList :: [Int] -> Int -> Int -> Int
jumpList js p s
  | p >= length js = s
  | otherwise      = jumpList (newList) (p+e) (s+1)
  where e       = (js!!p)
        newList = (take p js) ++ [e+1] ++ (drop (p+1) js)

day5_2 :: String -> Int
day5_2 s = jumpList' (processInput s) 0 0

jumpList' :: [Int] -> Int -> Int -> Int
jumpList' js p s
  | p >= length js = s
  | otherwise      = jumpList' (newList) (p+e) (s+1)
  where e       = (js!!p)
        off     = if e >= 3 then -1 else 1
        newList = (take p js) ++ ((e+off):(drop (p+1) js))


main :: IO ()
main = print $ day5_2 real1


day5_2' :: String -> Int
day5_2' s = jumpList'' (makeMap (processInput s) 0 Map.empty) 0 0


jumpList'' :: Map.Map Int Int -> Int -> Int -> Int
jumpList'' m p s
  | p >= Map.size m = s
  | otherwise      = jumpList'' (newMap) (p+e) (s+1)
  where e       = fromJust (Map.lookup p m)
        off     = if e >= 3 then -1 else 1
        newMap = Map.insert p (e+off) m --(take p js) ++ ((e+off):(drop (p+1) js))

makeMap :: [Int] -> Int -> Map.Map Int Int -> Map.Map Int Int
makeMap [] _ m = m
makeMap (i:is) n m = makeMap is (n+1) (Map.insert n i m)



test1 = "0\n3\n0\n1\n-3"
real1 = "2\n2\n1\n2\n-2\n2\n1\n1\n-4\n-2\n1\n-3\n-9\n2\n0\n1\n-8\n-9\n-12\n2\n-5\n-8\n0\n-11\n-3\n-1\n2\n-20\n-21\n-18\n-25\n-25\n-16\n-18\n-27\n-25\n-17\n-13\n-9\n-35\n-25\n-1\n-20\n-22\n-11\n-3\n-26\n-32\n-33\n-21\n-3\n-42\n-4\n-48\n-36\n-15\n-20\n-29\n-32\n-12\n-53\n-32\n0\n-4\n-2\n-32\n-55\n-49\n-23\n-18\n-34\n-39\n-70\n-4\n-64\n-58\n-66\n-59\n1\n-36\n-19\n-38\n-55\n-25\n-15\n-65\n-66\n-65\n-58\n-53\n-54\n-18\n-24\n-79\n-10\n-73\n-90\n-11\n-94\n-79\n-64\n-74\n-41\n-85\n-66\n-38\n-84\n-46\n-101\n-38\n-33\n-107\n-38\n-70\n-101\n-7\n-37\n-94\n1\n-69\n-42\n-71\n-15\n-36\n-70\n-76\n-42\n-118\n-39\n-97\n-27\n-30\n-6\n-70\n-23\n-113\n-103\n-89\n-35\n-43\n-11\n-97\n-137\n-19\n-6\n-21\n-107\n-93\n-50\n-107\n-46\n-90\n-51\n-115\n-134\n-122\n-88\n-122\n-74\n-30\n-10\n-53\n-12\n-152\n-68\n-110\n-123\n-111\n-40\n-164\n-10\n-168\n-38\n-71\n-67\n-171\n-146\n1\n-33\n-13\n-168\n-106\n-135\n-145\n-163\n-125\n-12\n-156\n-172\n-69\n0\n-15\n-137\n-1\n-21\n0\n-76\n-48\n-31\n-86\n-140\n-9\n-179\n-45\n-106\n-85\n-131\n-180\n-190\n-3\n-7\n-89\n-44\n-106\n-40\n-171\n-59\n-214\n-158\n-160\n-89\n-59\n-13\n0\n-215\n-110\n-204\n-39\n-171\n-44\n-173\n-112\n-153\n-155\n-85\n-113\n-226\n-74\n-104\n-152\n-5\n-187\n-171\n-12\n-165\n-190\n-152\n-49\n-177\n-179\n-123\n-158\n-131\n-244\n-143\n-127\n-124\n-125\n-170\n-211\n-201\n-97\n-33\n-47\n-243\n-136\n-243\n-89\n-192\n-217\n-105\n-116\n-268\n-40\n-154\n-262\n-223\n-96\n-20\n-66\n-239\n-42\n-24\n-112\n-162\n-227\n-52\n-81\n-80\n-3\n-33\n-152\n-33\n-168\n-48\n-245\n-87\n-74\n-139\n-295\n-17\n-73\n-180\n-48\n-182\n-162\n-59\n-296\n-37\n-241\n-67\n-83\n-218\n-124\n-136\n-303\n-38\n-85\n-205\n-137\n-14\n-248\n-13\n-212\n-266\n-304\n-294\n-54\n-145\n-22\n-312\n-298\n-23\n-5\n-126\n-307\n-190\n-294\n-43\n-293\n-339\n-129\n-223\n-231\n-59\n-104\n-60\n-239\n-11\n-291\n-242\n-115\n-117\n-89\n-7\n-57\n-280\n-70\n-70\n-6\n-35\n-124\n-253\n-120\n-322\n-45\n-187\n-288\n-237\n-76\n-192\n-179\n-269\n-14\n-269\n-227\n-374\n-84\n-15\n-144\n-266\n-256\n-162\n-336\n-266\n-31\n-367\n-172\n-156\n-157\n-220\n-189\n-152\n-336\n-253\n-36\n-324\n-222\n-175\n-313\n-289\n-65\n-123\n-229\n-204\n-44\n-72\n-20\n-78\n-43\n-226\n-93\n-399\n-10\n-150\n-153\n-221\n-7\n-302\n-237\n-288\n-172\n-233\n-119\n-247\n-33\n-170\n-46\n-424\n-403\n-40\n-65\n-116\n-372\n-148\n-336\n-287\n-431\n-134\n-354\n-14\n-162\n-228\n-152\n-119\n-240\n-356\n-305\n-15\n-77\n-303\n-189\n-205\n-380\n-175\n-316\n-396\n-44\n-42\n-142\n-363\n-418\n-313\n-322\n-307\n-363\n-454\n-157\n-308\n-361\n-398\n-347\n-249\n-57\n-453\n-167\n-194\n-29\n-443\n-45\n-359\n-445\n-89\n-136\n-60\n-446\n-97\n-282\n-298\n-245\n-91\n-130\n-423\n-387\n-492\n-282\n-415\n-64\n-294\n-468\n-251\n-323\n-210\n-490\n-142\n-121\n-393\n-251\n-265\n-268\n-135\n-224\n-116\n-7\n-27\n-165\n-265\n-352\n-226\n-25\n-327\n-490\n-493\n-80\n-501\n-522\n-436\n-36\n-464\n-47\n-349\n-91\n-460\n-167\n-436\n-207\n-41\n-386\n-461\n-430\n-412\n-161\n-460\n-488\n-207\n-221\n-17\n-265\n-115\n-36\n-499\n-111\n-518\n-390\n-526\n-280\n-150\n-405\n-458\n-503\n-527\n-303\n-383\n-154\n-317\n-64\n-379\n-564\n-385\n-490\n-524\n-440\n-69\n-317\n-377\n-53\n-503\n-136\n-71\n-190\n-19\n-238\n-572\n-281\n-294\n-538\n-146\n-130\n-406\n-236\n-223\n-234\n-16\n-436\n-391\n-249\n-508\n-153\n-41\n-380\n-229\n-489\n-466\n-94\n-596\n-96\n-544\n-532\n-106\n-349\n-34\n-162\n-6\n-495\n-287\n-82\n-307\n-466\n-358\n-272\n-282\n-220\n-84\n-168\n-124\n-271\n-307\n-164\n-627\n-442\n-348\n-368\n-548\n-574\n-248\n-144\n-516\n-369\n-319\n-215\n-476\n-191\n-326\n-462\n-286\n-565\n-395\n-190\n-353\n-180\n-88\n-403\n-520\n-203\n-268\n-198\n-374\n-636\n-565\n-76\n-447\n-118\n-658\n-311\n-468\n-214\n-215\n-68\n-370\n-179\n-286\n-394\n-532\n-493\n-339\n-471\n-344\n-274\n-512\n-90\n-306\n-222\n-348\n-331\n-670\n-73\n-136\n-358\n-518\n-521\n-41\n-204\n-476\n-582\n-633\n-44\n-133\n-410\n-658\n-443\n-158\n-76\n-162\n-509\n-150\n-304\n-407\n-210\n-667\n-279\n-109\n-469\n-680\n-702\n-101\n-159\n-197\n-134\n-154\n-270\n-90\n-568\n-237\n-95\n-328\n-23\n-493\n-310\n-649\n-283\n-31\n-234\n-126\n-244\n-312\n-409\n-84\n-522\n-72\n-458\n-190\n-707\n-338\n-433\n-709\n-81\n-693\n-367\n-302\n-260\n-322\n-282\n-379\n-401\n-60\n-126\n-645\n-573\n-91\n-685\n-312\n-165\n-217\n-594\n-386\n-357\n-72\n-426\n-354\n-246\n-278\n-451\n-37\n-484\n-232\n-638\n-569\n-376\n-278\n-554\n-666\n-191\n-513\n-564\n-502\n-640\n-531\n-1\n-667\n-146\n-20\n-375\n-771\n-263\n-754\n-182\n-190\n-626\n-249\n-418\n-278\n-722\n-676\n-161\n-666\n-462\n-488\n-70\n-569\n-779\n-642\n-121\n-556\n-146\n-531\n-323\n-116\n-100\n-76\n-260\n-339\n-743\n-44\n-811\n-137\n-456\n-462\n-469\n-500\n-650\n-681\n-424\n-336\n-445\n-172\n-604\n-776\n-133\n-829\n-72\n-88\n-219\n-247\n-269\n-205\n-532\n-222\n-232\n-201\n-762\n-105\n-478\n-263\n-177\n-475\n-584\n-439\n-316\n-722\n-371\n-35\n-132\n-417\n-385\n-695\n-76\n-452\n-201\n-848\n-359\n-731\n-721\n-211\n-698\n-502\n-113\n-271\n-31\n-66\n-588\n-794\n-189\n-417\n-715\n-96\n-95\n-691\n-587\n-193\n-788\n-445\n-761\n-347\n-696\n-34\n-14\n-358\n-633\n-152\n-140\n-371\n-795\n-500\n-477\n-617\n-83\n-462\n-338\n-167\n-345\n-99\n-806\n-798\n-447\n-338\n-263\n-76\n-382\n-913\n-577\n-657\n-69\n-344\n-853\n-679\n-204\n-560\n-238\n-455\n1\n-1\n-163\n-536\n-344\n-386\n-600\n-915\n-245\n-717\n-914\n-192\n-931\n-31\n-230\n-42\n-531\n-122\n-66\n-347\n-476\n-3\n-506\n-396\n-839\n-365\n-12\n-453\n-247\n-448\n-369\n-661\n-451\n-175\n-64\n-805\n-63\n-597\n-451\n-350\n-77\n-958\n-525\n-194\n-116\n-398\n-100\n-687\n-758\n-162\n-424\n-920\n-162\n-577\n-549\n-250\n-594\n-853\n-44\n-34\n-882\n-656\n-358\n-425\n-592\n-257\n-963\n-295\n-561\n-970\n-885\n-968\n-112\n-111\n-734\n-375\n-825\n-462\n-333\n-154\n-490\n-1004\n-391\n-925\n-175\n-299\n-985\n-432\n-165\n-721\n-289\n-817\n-393\n-831\n-697\n-599\n-145\n-977\n-550\n-577\n-249\n-743\n-711\n-4\n-442\n-252\n-897\n-130\n-528\n-906\n-809\n-228\n-548\n-695\n-912\n-676\n-936\n-209\n-312\n-951\n-671\n-898\n-205\n-730\n-873\n-798\n-943"